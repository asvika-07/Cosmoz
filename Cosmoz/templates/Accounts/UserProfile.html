{%extends "base.html"%}
{%block content%}

<head>
    <meta charset="utf-8">
    <!--  This file has been downloaded from bootdey.com    @bootdey on twitter -->
    <!--  All snippets are MIT license http://bootdey.com/license -->
    <title>profile with data and skills - Bootdey.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="http://netdna.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="http://netdna.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    </link>
    <style type="text/css">
        body {
            /* margin-top:20px; */
            color: #1a202c;
            text-align: left;
            background-color: #E5E4E2;
        }

        .main-body {
            padding: 15px;
        }

        .card {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .1), 0 1px 2px 0 rgba(0, 0, 0, .06);
        }

        .card {
            position: relative;
            display: flex;
            flex-direction: column;
            min-width: 0;
            word-wrap: break-word;
            background-color: #fff;
            background-clip: border-box;
            border: 0 solid rgba(0, 0, 0, .125);
            border-radius: 2px;
        }

        .card-body {

            min-height: 1px;
            padding: 1rem;

        }

        .gutters-sm {
            margin-right: -8px;
            margin-left: -8px;
        }

        .gutters-sm>.col,
        .gutters-sm>[class*=col-] {
            padding-right: 8px;
            padding-left: 8px;
        }

        .mb-3,
        .my-3 {
            margin-bottom: 1rem !important;
        }

        .bg-gray-300 {
            background-color: #e2e8f0;
        }

        .h-100 {
            height: 100% !important;
        }

        .shadow-none {
            box-shadow: none !important;
        }

        .rounded-circle {
            height: 140px !important;
            width: 140px !important;
        }

        .btn-profile {
            background: none;
        }

        .btn_profile a {
            color: black;
            text-decoration: none;
        }


        .profile-header .profile-header-tab {
            background: #fff;
            list-style-type: none;
            margin: -10px 0 0;
            padding: 0 0 0 140px;
            white-space: nowrap;
            border-radius: 0
        }

        .text-ellipsis,
        .text-nowrap {
            white-space: nowrap !important
        }

        .profile-header .profile-header-tab>li {
            display: inline-block;
            margin: 0
        }

        .profile-header .profile-header-tab>li>a {
            display: block;
            color: #929ba1;
            line-height: 20px;
            padding: 10px 20px;
            text-decoration: none;
            font-weight: 700;
            font-size: 12px;
            border: none
        }

        .profile-header .profile-header-tab>li.active>a,
        .profile-header .profile-header-tab>li>a.active {
            color: #242a30
        }

        .profile-content {
            padding: 25px;
            border-radius: 4px
        }

        .profile-content:after,
        .profile-content:before {
            content: '';
            display: table;
            clear: both
        }

        .profile-content .tab-content,
        .profile-content .tab-pane {
            background: 0 0
        }

        .collapse {
            background-color: aquamarine;
        }

        [data-toggle="collapse"]:after {
            display: inline-block;
            display: inline-block;
            font: normal normal normal 14px/1 FontAwesome;
            font-size: inherit;
            text-rendering: auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            content: "\f054";
            transform: rotate(90deg);
            transition: all linear 0.25s;
            float: right;
        }

        [data-toggle="collapse"].collapsed:after {
            transform: rotate(0deg);
        }

        /* body{font-family: FontAwesome;} */

        /* Style the tab */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        /* Style the buttons inside the tab */
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
        }

        /* Change background color of buttons on hover */
        .tab button:hover {
            background-color: #ddd;
        }

        /* Create an active/current tablink class */
        .tab button.active {
            background-color: #ccc;
        }

        /* Style the tab content */
        .tabcontent {
            display: none;
            padding: 15px 20px;
            border: 1px solid #ccc;
            border-top: none;
        }
    </style>
</head>

<body>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <div class="container">
        <div class="main-body">
            <div class="row gutters-sm">
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex flex-column align-items-center text-center">
                                <img src="{{ProfilePicture}}" alt="Admin" class="rounded-circle" width="150">
                                <div class="mt-3">
                                    <h4>{{username}}</h4>
                                    <p class="text-secondary mb-1">{{UserType}}</p>
                                    <p class="text-muted font-size-sm">Coimbatore, India</p>

                                    <div class="btn_profile"><button class="btn btn-outline-primary"><a
                                                href="{% url 'Connect:list' user_id=email%}">Friends
                                                ({{friends|length}})</button></a>
                                        {% if is_self %}
                                        <button class="btn btn-outline-primary"><a
                                                href="{% url 'profile_edit_view' email=email %}">Edit
                                                Profile</a></button>
                                        {% endif %}
                                        {% if is_friend == False and is_self == False %}

                                        {% if request_sent == 1 %}
                                        <div class="d-flex flex-column align-items-center pt-4">
                                            <button class="btn btn-outline-primary" id="id_cancel_friend_request_btn">
                                                Cancel Friend Request
                                            </button>
                                        </div>
                                        {% endif %}
                                        {% if request_sent == -1 %}
                                        <div class="d-flex flex-column align-items-center pt-4">
                                            <button class="btn btn-outline-primary" id="id_send_friend_request_btn">
                                                Send Friend Request
                                            </button>
                                        </div>
                                        {% endif %}
                                        {% endif %}


                                        {% if is_friend %}
                                        <div class="dropdown pt-4 m-auto">
                                            <button class="btn btn-outline-primary" type="button" id="id_friends_toggle"
                                                data-toggle="dropdown"
                                                onclick="removeFriend('{{email}}', onFriendRemoved)">Unfriend
                                            </button>
                                        </div>
                                        {% endif %}

                                        <!-- Friend list link -->
                                        {% if request.user.is_authenticated %}
                                        <div class="d-flex flex-column mb-4">
                                            <!-- THEM to YOU -->
                                            {% if request_sent == 0 %}

                                            <div class="d-flex flex-row align-items-center">
                                                <button class="btn btn-outline-primary"
                                                    onclick='triggerAcceptFriendRequest("{{pending_friend_request_id}}")'>Accept</button>
                                                <button class="btn btn-outline-primary"
                                                    onclick='triggerDeclineFriendRequest("{{pending_friend_request_id}}")'>Cancel</button>
                                            </div>

                                            {% endif %}
                                            {% if friend_requests %}
                                            <div>
                                                <!-- Friend requests -->
                                                <div>

                                                    <a data-toggle="modal"
                                                        href="{% url 'Connect:friend-requests' user_id=email%}"
                                                        data-target="#FriendRequest" data-tooltip>

                                                        <span class="friend-text"><button class="btn btn-primary">
                                                                Friend Requests
                                                                ({{friend_requests|length}})</button></span>

                                                    </a>
                                                </div>
                                            </div>
                                            {% endif %}

                                        </div>
                                        {% endif %}

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <ul class="list-group list-grou  p-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round"
                                        class="feather feather-globe mr-2 icon-inline">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="2" y1="12" x2="22" y2="12"></line>
                                        <path
                                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                                        </path>
                                    </svg>Website</h6>
                                <span class="text-secondary">https://bootdey.com</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round"
                                        class="feather feather-github mr-2 icon-inline">
                                        <path
                                            d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
                                        </path>
                                    </svg>Github</h6>
                                <span class="text-secondary">bootdey</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round"
                                        class="feather feather-twitter mr-2 icon-inline text-info">
                                        <path
                                            d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
                                        </path>
                                    </svg>Twitter</h6>
                                <span class="text-secondary">@bootdey</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round"
                                        class="feather feather-instagram mr-2 icon-inline text-danger">
                                        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                                        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                                    </svg>Instagram</h6>
                                <span class="text-secondary">bootdey</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round"
                                        class="feather feather-facebook mr-2 icon-inline text-primary">
                                        <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z">
                                        </path>
                                    </svg>Facebook</h6>
                                <span class="text-secondary">bootdey</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">Full Name</h6>
                                </div>
                                <div class="col-sm-9 text-secondary">
                                    {{FirstName}} {{LastName}}
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">Email</h6>
                                </div>
                                <div class="col-sm-9 text-secondary">
                                    {{email}}
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">Phone</h6>
                                </div>
                                
                                <div class="col-sm-9 text-secondary">
                                    {% if UserType == Faculty %}
                                    {{MobileNumber}}
                                    {% else %}
                                    ****
                                    {% endif %}
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">RegistrationID</h6>
                                </div>
                                <div class="col-sm-9 text-secondary">
                                    {{RegistrationID}}
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">D.O.B</h6>
                                </div>
                                <div class="col-sm-9 text-secondary">
                                    {{DateOfBirth}}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="accordion" role="tablist">

                        <div class="card">
                            <!-- <div class="card-header" role="tab" id="headingOne">
                                <div class="tabs">
                                    <button class="tablinks" onclick=>Post</button>
                                   <li class="nav-item"><a href="#profile-post" class="nav-link"  data-target="#demo">POSTS</a></li>
                                  <li class="nav-item"><a href="#profile-about" class="nav-link"  data-target="#demo1">QUESTIONS</a></li>
                                  <li class="nav-item"><a href="#profile-photos" class="nav-link"  data-target="#demo2" >ANSWERS</a></li> -->
                            <!-- </ul> -->

                            <div class="tab">
                                <button class="tablinks" onclick="openCity(event, 'London')">Post</button>
                                <button class="tablinks" onclick="openCity(event, 'Paris')">Questions</button>
                                <button class="tablinks" onclick="openCity(event, 'Tokyo')">Answers</button>
                            </div>

                            <div id="London" class="tabcontent">

                                {% for post in user_posts %}
                                <h6><a href="{% url 'Post-view' post.PostID%}">{{post.Title}}</a></h6>
                                {{post.TextContent | safe}}
                                {% if is_self %}
                                <a href="{% url 'PostEdit-view' post.PostID%}">Edit Post</a>
                                <a href="{% url 'PostDelete-view' post.PostID %}">Delete Post</a>
                                {% endif %}
                                {% endfor %}
                            </div>

                            <div id="Paris" class="tabcontent">
                                {% for question in user_question %}
                                <h4><a href="{% url 'Question-view' question.QuestionID%}">{{question.Question}}</a>
                                </h4>
                                {% if is_self %}
                                <a href="{% url 'QuestionEdit-view' question.QuestionID%}">Edit Question</a>
                                <a href="{% url 'QuestionDelete-view' question.QuestionID%}">Delete Question</a>
                                {% endif %}
                                {% endfor %}
                            </div>

                            <div id="Tokyo" class="tabcontent">
                                {% for answer in user_answer %}
                                {{answer.question_id.QuestionID}}
                                <h4><a
                                        href="{% url 'Question-view' answer.question_id.QuestionID%}">{{answer.question_id.Question}}</a>
                                </h4>
                                {{answer.Answer|safe}}
                                {% if is_self %}
                                <a
                                    href="{% url 'Answer-edit' ques_id=answer.question_id.QuestionID answer_id=answer.AnsweID%}">Edit
                                    Question</a>
                                <a
                                    href="{% url 'Answer-delete' ques_id=answer.question_id.QuestionID answer_id=answer.AnsweID%}">Delete
                                    Question</a>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="FriendRequest" tabindex="-1" role="dialog"
                    aria-labelledby="threadModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <form method="POST" enctype="multipart/form-data"
                                action="{% url 'Connect:friend-requests' user_id=email%}">
                                {% csrf_token %}
                                <div class="modal-header d-flex align-items-center bg-primary text-white">
                                    <h6 class="modal-title mb-0" id="threadModalLabel">Friend
                                        requests</h6>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <script src="https://code.jquery.com/jquery-3.6.0.slim.js"
                                        integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY="
                                        crossorigin="anonymous"></script>

                                    {% if friend_requests %}
                                    <div>
                                        {% for request in friend_requests %}
                                        <div>
                                            <a href="{% url 'account_view' email=request.sender.email %}">
                                                <div>
                                                    <img src="{{request.sender.ProfilePicture.url}}"
                                                        alt="no profile picture" class="rounded-circle" width="150">

                                                </div>
                                            </a>
                                            <a href="{% url 'account_view' email=request.sender.email %}">
                                                <div>
                                                    <h4>{{request.sender.username}}</h4>
                                                </div>
                                            </a>
                                            <div>
                                                <button type="button" class="btn btn-outline-primary"
                                                    onclick='triggerDeclineFriendRequest("{{request.id}}")'>Decline</button>
                                                <button type="button" class="btn btn-outline-primary"
                                                    onclick='triggerAcceptFriendRequest("{{request.id}}")'>Accept</button>

                                            </div>
                                        </div>
                                        {% endfor %}

                                        {% else %}
                                        <div>
                                            <p>No results</p>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <script type="text/javascript">

                                        function onFriendRequestAccepted() {
                                            location.reload();
                                            location.href = "{% url 'account_view' email=email %}";
                                        }

                                        function onFriendRequestDeclined() {
                                            location.reload();
                                            location.href = "{% url 'account_view' email=email %}";
                                        }

                                        function triggerAcceptFriendRequest(friend_request_id) {
                                            acceptFriendRequest(friend_request_id, onFriendRequestAccepted)
                                        }

                                        function triggerDeclineFriendRequest(friend_request_id) {
                                            declineFriendRequest(friend_request_id, onFriendRequestDeclined)
                                        }
                                    </script>



                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
                <script src="http://netdna.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
                <script type="text/javascript">

                </script>



                <script type="text/javascript">
                    function onFriendRequestSent() {
                        location.reload();
                    }

                    function onFriendRequestCancelled() {
                        location.reload();
                    }

                    function onFriendRemoved() {
                        location.reload();
                    }

                    function onFriendRequestAccepted() {
                        location.reload();
                    }

                    function onFriendRequestDeclined() {
                        location.reload();
                    }


                    var sendFriendRequestBtn = document.getElementById("id_send_friend_request_btn")
                    if (sendFriendRequestBtn != null) {
                        sendFriendRequestBtn.addEventListener("click", function () {
                            sendFriendRequest("{{email}}", onFriendRequestSent)
                        })
                    }

                    var cancelFriendRequestBtn = document.getElementById("id_cancel_friend_request_btn")
                    if (cancelFriendRequestBtn != null) {
                        cancelFriendRequestBtn.addEventListener("click", function () {
                            cancelFriendRequest("{{email}}", onFriendRequestCancelled)
                        })
                    }

                    var removeFriendBtn = document.getElementById("id_unfriend_btn")
                    if (removeFriendBtn != null) {
                        removeFriendBtn.addEventListener("click", function () {
                            removeFriend("{{email}}", onFriendRemoved)
                        })
                    }

                    function triggerAcceptFriendRequest(friend_request_id) {
                        acceptFriendRequest(friend_request_id, onFriendRequestAccepted)
                    }

                    function triggerDeclineFriendRequest(friend_request_id) {
                        declineFriendRequest(friend_request_id, onFriendRequestDeclined)
                    }

                    function openCity(evt, cityName) {
                        var i, tabcontent, tablinks;
                        tabcontent = document.getElementsByClassName("tabcontent");
                        for (i = 0; i < tabcontent.length; i++) {
                            tabcontent[i].style.display = "none";
                        }
                        tablinks = document.getElementsByClassName("tablinks");
                        for (i = 0; i < tablinks.length; i++) {
                            tablinks[i].className = tablinks[i].className.replace(" active", "");
                        }
                        document.getElementById(cityName).style.display = "block";
                        evt.currentTarget.className += " active";
                    }

                </script>

                {% include 'friend/snippets/send_friend_request.html' %}
                {% include 'friend/snippets/accept_friend_request.html' %}
                {% include 'friend/snippets/decline_friend_request.html' %}
                {% include 'friend/snippets/cancel_friend_request.html' %}
                {% include 'friend/snippets/remove_friend.html' %}


</body>

{% endblock %}